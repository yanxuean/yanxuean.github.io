---
layout: post
title: 正交设计
categories: [software engineering]
description: 正交设计方法论
keywords: 正交设计 
---


## 简介
**正交** 就是指两个事物各自独立变化，互不影响。

降低复杂度 --》 模块化设计(分模块，定关系) --》局部化影响 --》高内聚低耦合 --》正交设计（更具体）--》SOLID --》 设计模式

[摘自作者的文章](https://www.jianshu.com/p/d127b8afc8cb)
[刘光聪的实践]https://dev.zte.com.cn/topic/#/30087

一个出发点：模块化设计
两个问题：怎么分，怎么合（协作）
三方关系：客户，API，实现，以及他们之间的关系。
四个策略：消除重复，分离不同的变化方向，缩小依赖范围，向稳定的方向依赖

## 当前设计方法存在的问题
### 模块化设计，两个问题：
1、究竟软件模块该怎样划分才是合理的?  侧重划分单元
2、怎样定义API才是合理的?  侧重单元之间的关系


## 解决
### 为何要做软件设计?
对此，Kent Beck：
软件设计是为了在让软件在长期范围内容易应对变化。
提出了一个更为精炼的原则：局部化影响。
意思是说：我们希望，任何一个变化，对于我们当前的软件设计影响范围都可以控制在一个尽量小的局部。

### 方法1：内聚与耦合

模块化设计的全部：首先将一个低内聚的模块首先拆分为多个高内聚的模块；然后再考虑这多个模块之间的API设计，以降低这些高内聚的软件单元之间的耦合度。

除了内聚与耦合之外，还有一种关系：正交。
具备正交关系的两个模块，可以做到一方的变化不会影响另外一方的变化。换句话说，双方各自独自变化，互不影响


### 方法2：正交设计
局部化影响，高内聚低耦合原则 都更描述目标或结果，没有指明达成的方法。
我们需要从它推导出更为明确，更具指导性和操作性的设计原则

#### 内聚及识别难点
Uncle Bob说：一个类只应该有一个变化原因。
他进一步谈到：所谓一个变化原因，指一个变化会导致整个类所包含的各个元素都要发生变化。为何会如此？
因为它们的关联程度太紧密(因而高内聚)，以至于牵一发而动全身。因此，Uncle Bob将**职责**定义为**变化原因**。

难点：
如果我们进行猜测，会发现很多点都有变化的可能，如果对这些变化都进行分离和管理，确实会提高系统的内聚度。但如果我们现在就将整个系统每个可能的变化点都分离出来，无疑会让整个系统陷入无边无际的不必要的复杂度。

破解这类难题的方法是：既然我们知道高内聚，低耦合的设计是为了软件更容易应对变化的，那么我们为何不反过来，让**实际发生的需求变化来驱动**我们识别变化，管理变化，从而让我们的系统达到恰如其分的内聚度和耦合度?


#### 怎样达到高内聚，低耦合，正交：
* 策略一：消除重复，             关注拆分模块，更内聚
* 策略二：分离不同的变化方向。   关注拆分模块，更内聚。只保留一个变化方向，职责更单一，更内聚
	当你发现需求导致一个变化方向出现时，将其从原有的设计中分离出去。
	比如排序算法中的“具体的排序目标(老师，学生)，排序方向”就是两个不同的变化方向。
	“变化方向”理解的不是很清晰。
* 策略三：缩小依赖范围           关注模块之间的关系，怎么定义API（把API当成一个独立实体，不是其它人的属性）
    API应包含尽可能少的知识。因为任何一项知识的变化都会导致双方的变化;  --- 啥叫知识？带的信息量尽量少
    API也应该高内聚，而不应该强迫API的客户依赖它不需要的东西。
	
  API定义所带来的耦合度影响，需要遵循如下原则：	
	首先，客户和实现模块的数量，会对耦合度产生重大的影响。它们数量越多，意味着 API 变更的成本越高，越需要花更大的精力来仔细斟酌。
    其次，对于影响面大的API（也意味着耦合度高），需要使用更加弹性的API定义框架，以有利于向前兼容性。

* 策略四：向着稳定的方向依赖     关注模块之间的关系，怎么定义API
    耦合的最大问题在于：耦合点的变化，会导致依赖方跟着变化。尽量保持耦合点稳定就能避免。
	究竟什么样的API更倾向于稳定？不难知道，站在What，而不是How的角度；即站在需求的角度，而不是实现方式的角度定义API，会让其更加稳定。
	而需求的提出方，一定是客户端，而不是实现侧。这就意味着，我们在定义接口时，应该站在客户的角度，思考用户的本质需要，由此来定义API。而**不是站在技术实现的方便程度角度来思考API定义**。而这正是封装或信息隐藏的关键。


这四个策略的背后动力非常明确：变化。
前两者，都是在明确的变化方向被第一次识别之后（所谓第一颗子弹），进行策略运用，以让模块在变化面前越来越高内聚。
而后两者，则是在模块职责分离之后，需要定义模块间API时，尽可能考虑不同的API定义方式对于依赖双方的影响，以达到低耦合。
由于这四个策略致力于让系统朝着更具正交性的方向演进，因而它们也被称做正交策略，或者正交四原则。

## 总结
本文首先从一个出发点出发：为了降低软件复杂度，提升可重用性，我们需要模块化。
由此得到了两个问题：模块划分必然要解决如何划分，以及模块间如何协作（API 定义）的问题。
基于软件易于应对变化的角度出发。高内聚、低耦合原则是最为核心和关键的高层原则。基于此我们得到了在模块化过程中，我们真正需要关注的三方关系。
为了让高内聚、低耦合更具指导性和操作性，我们提出了四个策略。它们以变化驱动，让系统逐步向更好的正交性演进的策略，因此也被称做正交策略或正交原则。
我们已经在多个系统的设计和开发中，以这四个原则来驱动我们的软件设计，不仅让我们的系统在保持简单的同时，具备所有必要的灵活性。也让设计和开发活动变得高度有章可循，让团队生产率得以大幅提升。



